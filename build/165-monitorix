#!/bin/bash

# Set the URL of the latest debpack from https://www.monitorix.org/downloads.html
debpack=https://www.monitorix.org/monitorix_3.10.1-izzy1_all.deb

# Download the debpack
wget --no-check-certificate -O /tmp/monitorix.deb $debpack

# Remove Izzy Repos
rm -f /etc/apt/sources.list.d/monitorix.list
apt update

# Install dependencies
apt install -y rrdtool
apt install -y perl
apt install -y libwww-perl
apt install -y libmailtools-perl
apt install -y libmime-lite-perl
apt install -y librrds-perl
apt install -y libdbi-perl
apt install -y libxml-simple-perl
apt install -y libhttp-server-simple-perl
apt install -y libconfig-general-perl
apt install -y libio-socket-ssl-perl

# Install Monitorix
dpkg -i /tmp/monitorix.deb

# Use NEMS config files
systemctl stop monitorix
cp -f /root/nems/nems-migrator/data/1.4/monitorix/monitorix.conf /etc/monitorix/
cp -f /root/nems/nems-migrator/data/1.4/monitorix/raspberrypi.rrd /var/lib/monitorix/

# Make it so
systemctl start monitorix
systemctl enable monitorix
