#!/bin/bash
echo $0 > /var/www/html/userfiles/nems-build.cur

# Thanks to Ryan Siegel for the original contribution in NEMS Linux 1.2.1.

# Updated for NEMS Linux 1.5 since openvas stopped distributing the package.

# Updated for NEMS Linux 1.6: Entirely deprecated the old (unsupported) wmic
# application and moved to a Python-based alternative (drop-in replacement)
# in the NEMS Linux repository.

printf "Installing check_wmi_plus... "
# Remove previous install of check_wmi_plus
if [[ -e /etc/check_wmi_plus/ ]]; then
  rm -rf /etc/check_wmi_plus/
fi
# Install check_wmi_plus
cp -f /root/nems/nems-migrator/data/1.6/nagios/plugins/check_wmi_plus.pl /usr/lib/nagios/plugins/

# Copy the configs
cp -rf /root/nems/nems-migrator/data/1.6/check_wmi_plus /etc/

# Create the ini dir (which is designated in the conf below)
if [[ ! -e /etc/check_wmi_plus/check_wmi_plus.d ]]; then
  mkdir /etc/check_wmi_plus/check_wmi_plus.d
fi

# Set ownership
chown -R nagios:nagios /etc/check_wmi_plus/

echo "Done."
