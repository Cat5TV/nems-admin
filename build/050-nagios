#!/bin/bash

# Install Nagios Core
  useradd nagios
  groupadd nagcmd
  usermod -a -G nagios www-data
  usermod -a -G nagcmd nagios
  usermod -a -G nagcmd www-data
  cd /tmp
  wget https://assets.nagios.com/downloads/nagioscore/releases/nagios-4.3.4.tar.gz
  tar -zxvf nagios-4.3.4.tar.gz
  cd /tmp/nagios-4.3.4/
  ./configure --with-nagios-group=nagios --with-command-group=nagcmd --with-httpd_conf=/etc/apache2/conf-available/
  make all
  make install
  make install-init
  make install-config
  make install-commandmode
  make install-webconf

  cd /tmp
  # Install dependencies
  apt update
  apt install -y \
    libnet-snmp-perl \
    snmp \
    snmpd \
    snmp-mibs-downloader \
    dnsutils \
    fping \
    iputils-ping \
    libfreeradius-client-dev \
    libldap2-dev \
    default-libmysqlclient-dev \
    libdbi-dev \
    libdbi-perl \
    smbclient \
    qstat


# Finished installing Nagios Core

# Install some needed extras
apt install -y nagios-nrpe-plugin nagios-nrpe-server nagios-images

# Set the nagios user shell
usermod -s /bin/bash nagios
